# Configurações da aplicação CEI Digital
 # - Variáveis de conexão com banco Postgres para ambiente local
 # - JPA com ddl-auto=update para criar/atualizar o schema automaticamente em desenvolvimento
logging:
  level:
    org.springframework.jdbc.datasource: DEBUG
    org.hibernate.engine.jdbc.connections: DEBUG
spring:
  application:
    name: CEI Digital

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/cei_db}
    username: ${SPRING_DATASOURCE_USERNAME:ceiuser}
    password: ${SPRING_DATASOURCE_PASSWORD:ceipass}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      # Em produção, considere usar 'validate' e gerenciar migrações com Flyway/Liquibase
      ddl-auto: update
    show-sql: true
---
spring:
  config:
    activate:
      on-profile: fly
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

  # Internacionalização e localização
  messages:
    basename: messages
    encoding: UTF-8
  web:
    locale: pt_BR # fallback padrão
    locale-resolver: accept-header # usa o cabeçalho Accept-Language do cliente

  # Configuração de e-mail (usar variáveis de ambiente em dev/prod)
  mail:
    # Para testar local com Mailpit/MailHog, use host=localhost e port=1025
    host: ${SPRING_MAIL_HOST:localhost}
    port: ${SPRING_MAIL_PORT:1025}
    username: ${SPRING_MAIL_USERNAME:}
    password: ${SPRING_MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          # Para Mailpit/MailHog locais, geralmente não requer AUTH/STARTTLS
          auth: ${SPRING_MAIL_AUTH:false}
          starttls:
            enable: ${SPRING_MAIL_STARTTLS:false}
    from: ${SPRING_MAIL_FROM:no-reply@localhost}

server:
  # Porta padrão para desenvolvimento. Pode ser sobrescrita por variável de ambiente SERVER_PORT
  port: ${SERVER_PORT:8081}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true

security:
  jwt:
    # Chave secreta para assinar tokens JWT (mínimo ~32 bytes para HS256)
    secret: ${JWT_SECRET}
    # Validade do token em segundos (ex.: 86400 = 1 dia)
    expiration: ${JWT_EXPIRATION:86400}

# Parâmetros do usuário administrador inicial (apenas para desenvolvimento)
app:
  admin:
    email: ${APP_ADMIN_EMAIL}
    password: ${APP_ADMIN_PASSWORD}
  cors:
    # Origens permitidas (separadas por vírgula). Ajuste para incluir o domínio do Cloudflare Pages.
    allowed-origins: ${APP_CORS_ALLOWED_ORIGINS:http://localhost:4200,http://127.0.0.1:4200}

# Configuração Twilio (SMS/WhatsApp)
twilio:
  account-sid: ${TWILIO_ACCOUNT_SID:}
  auth-token: ${TWILIO_AUTH_TOKEN:}
  from-number: ${TWILIO_FROM_NUMBER:}
  # Número/sender habilitado no WhatsApp pelo Twilio (em E.164), ex.: +14155238886
  whatsapp-from: ${TWILIO_WHATSAPP_FROM:}

# WhatsApp
notification:
  whatsapp:
    # Habilita envio via WhatsApp (Twilio WhatsApp Business). Padrão: false
    enabled: ${WHATSAPP_ENABLED:false}

# Debug
debug:
  whatsapp:
    enabled: true

# Compatibilidade para leitura direta de 'security.jwt.secret'
security.jwt.secret: ${JWT_SECRET}
